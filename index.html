<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="/logo-mathswell-square-mirror.ico" type="image/x-icon">
<link rel="icon" href="/logo-mathswell-square-mirror.svg" type="image/svg+xml">
    <meta charset="UTF-8">
    <title>If-Then â€“ Interactive Logic Learning System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- MathJax for beautiful math typesetting -->
    <script>
        window.MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
          },
          svg: {
            fontCache: 'global'
          },
          startup: {
            ready: () => {
              console.log('MathJax is ready!');
              window.MathJax.startup.defaultReady();
            }
          }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary-color: #0f766e;
            --primary-light: #e6fffa;
            --primary-dark: #0a4842;
            --secondary-color: #7c3aed;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --light-gray: #f8fafc;
            --medium-gray: #e2e8f0;
            --dark-gray: #475569;
            --text-color: #1e293b;
            --bg-color: #f1f5f9;
            --card-color: #ffffff;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #0f766e 0%, #064e3b 100%);
            --gradient-3: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
            --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6; 
            background: linear-gradient(135deg, #e6fffa 0%, #f1f5f9 100%);
            color: var(--text-color);
            display: flex; 
            justify-content: center; 
            padding: 1rem;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(15, 118, 110, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(124, 58, 237, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(245, 158, 11, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            width: 100%; 
            max-width: 900px; 
            margin: 1rem auto; 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-xl), 0 0 0 1px rgba(15, 118, 110, 0.1); 
            border: 1px solid rgba(226, 232, 240, 0.5); 
            border-radius: 20px; 
            padding: 2.5rem;
            position: relative;
            z-index: 1;
        }
        
        h1 { 
            font-size: 2.25rem; 
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem; 
            text-align: center; 
            font-weight: 800;
            letter-spacing: -0.025em;
        }
        
        h2 { 
            font-size: 1.75rem; 
            color: var(--primary-dark); 
            margin-top: 2rem; 
            margin-bottom: 1.5rem; 
            padding-bottom: 0.75rem;
            position: relative;
            font-weight: 700;
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--gradient-2);
            border-radius: 2px;
        }
        
        h3 { 
            font-size: 1.25rem; 
            color: var(--primary-color); 
            margin-bottom: 1rem; 
            font-weight: 600;
        }

        /* Progress Bar */
        .progress-container {
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--light-gray);
            border-radius: 12px;
        }
        
        .progress-bar {
            height: 8px;
            background: var(--medium-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-2);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--dark-gray);
        }
        
        /* Enhanced Tabs */
        .tabs { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 0.75rem; 
            margin-bottom: 2.5rem; 
            justify-content: center;
            padding: 0.5rem;
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.05) 0%, rgba(124, 58, 237, 0.05) 100%);
            border-radius: 16px;
        }
        
        .tab {
            padding: 0.875rem 2rem;
            background: white;
            border: 2px solid transparent;
            cursor: pointer;
            font-size: 1.05rem;
            color: var(--dark-gray);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .tab.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .tab .lock-icon {
            margin-left: 0.5rem;
            font-size: 0.9rem;
        }
        
        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-2);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        
        .tab:not(.locked):hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }
        
        .tab.active {
            color: white;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .tab.active::before {
            opacity: 1;
        }
        
        .tab-content { 
            display: none; 
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tab-content.active { display: block; }
        
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Interactive Tutorial */
        .tutorial-step {
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.08) 0%, rgba(124, 58, 237, 0.04) 100%);
            border-left: 4px solid;
            border-image: var(--gradient-2) 1;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        .tutorial-step.completed {
            opacity: 0.7;
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--gradient-2);
            color: white;
            border-radius: 50%;
            font-weight: bold;
        }
        
        .example-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        @media (min-width: 600px) {
            .example-container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .example-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        
        .example-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .example-card h4 {
            color: var(--primary-dark);
            margin-bottom: 0.75rem;
        }
        
        /* Interactive Exploration Mode */
        .exploration-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--light-gray);
            border-radius: 16px;
        }
        
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .slider-group label {
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--medium-gray);
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--gradient-2);
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--gradient-2);
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }
        
        /* Test Cases Feature */
        .test-case-panel {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1.5rem;
        }
        
        .test-case-input {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .test-case-input input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .test-case-input button {
            padding: 0.75rem 1.5rem;
            background: var(--gradient-2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .test-case-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .test-result {
            padding: 1rem;
            background: white;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }
        
        .test-result.satisfies {
            border: 2px solid var(--success-color);
            background: rgba(16, 185, 129, 0.05);
        }
        
        .test-result.fails {
            border: 2px solid var(--error-color);
            background: rgba(239, 68, 68, 0.05);
        }
        
        /* Confidence Rating */
        .confidence-rating {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .confidence-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--medium-gray);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .confidence-btn:hover {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }
        
        .confidence-btn.selected {
            background: var(--gradient-2);
            color: white;
            border-color: transparent;
        }
        
        /* Hint System */
        .hint-container {
            margin: 1.5rem 0;
            text-align: center;
        }
        
        .hint-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--warning-color) 0%, #ea580c 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .hint-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .hint-text {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(245, 158, 11, 0.1);
            border-left: 3px solid var(--warning-color);
            border-radius: 8px;
            text-align: left;
            display: none;
        }
        
        .hint-text.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        /* Truth Table */
        .truth-table {
            margin: 2rem 0;
            overflow-x: auto;
        }
        
        .truth-table table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .truth-table th {
            background: var(--gradient-2);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
        }
        
        .truth-table td {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .truth-table tr:hover {
            background: var(--light-gray);
        }
        
        .truth-value-true {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .truth-value-false {
            color: var(--error-color);
            font-weight: 600;
        }
        
        /* Enhanced Venn Diagram */
        .venn-container { 
            position: relative; 
            width: 100%; 
            max-width: 400px; 
            margin: 0 auto;
            padding: 1rem;
        }
        
        .venn-box {
            width: 100%;
            max-width: 400px;
            height: 400px;
            margin: 0 auto;
            border-radius: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }
        
        .venn-box.interactive-mode {
            box-shadow: 0 0 0 3px var(--primary-color), var(--shadow-xl);
        }
        
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0 0 rgba(15, 118, 110, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(15, 118, 110, 0); }
            100% { box-shadow: 0 0 0 0 rgba(15, 118, 110, 0); }
        }
        
        .hint-highlight {
            animation: pulseGlow 2s infinite;
        }
        
        .venn-box:hover:not(.locked) {
            box-shadow: var(--shadow-xl);
            transform: scale(1.02);
        }
        
        .venn-box.locked {
            cursor: default;
            filter: grayscale(0.3) brightness(0.98);
        }
        
        /* Analysis Lab Enhancements */
        .analysis-reveal-container {
            margin: 2rem 0;
        }
        
        .reveal-btn {
            padding: 0.75rem 1.5rem;
            background: var(--gradient-2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .reveal-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .reveal-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .comparison-mode {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .comparison-card {
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        
        .comparison-card.highlight {
            box-shadow: 0 0 0 2px var(--primary-color), var(--shadow-lg);
        }
        
        /* Feedback Enhancements */
        .feedback-detailed {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
        }
        
        .feedback-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .feedback-step-number {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            background: var(--gradient-2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
        }
        
        .feedback-step-content {
            flex: 1;
        }
        
        /* Stats Dashboard */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .stat-card {
            padding: 1rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--dark-gray);
            margin-top: 0.25rem;
        }
        
        .hidden {
            display: none;
        }
        
        .btn-primary {
            padding: 0.875rem 2rem;
            background: var(--gradient-2);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-primary:disabled {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .btn-secondary {
            padding: 0.875rem 2rem;
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

    </style>
    <!-- Mathswell app navbar styles -->
<style>
  .mathswell-nav {
    display: flex;
    justify-content: center;
    margin: .4rem 0 1rem;
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  .mathswell-nav .mw-link {
    display: inline-flex;
    align-items: center;
    gap: .45rem;
    text-decoration: none;
    font-weight: 700;
    font-size: 1rem;
    color: #0f766e;
    padding: .3rem .7rem;
    border-radius: 999px;
    background: rgba(255,255,255,.9);
    box-shadow: 0 1px 4px rgba(0,0,0,.08);
  }
  .mathswell-nav .mw-link img {
    display: block;
  }
</style>
</head>
<body>
    <div class="container">
        <h1>If-Then: Interactive Logic Learning System</h1>
         <!-- Mathswell brand badge -->
<div style="display:flex;justify-content:center;margin:.75rem 0 1rem;
            position:relative;z-index:1001;">
  <a href="https://mathswell.com" style="display:inline-flex;align-items:center;gap:.5rem;
      text-decoration:none;font-weight:800;font-size:1.05rem;color:#0f766e;
      padding:.4rem .8rem;border-radius:999px;background:#fff;
      box-shadow:0 1px 4px rgba(0,0,0,.08);">
    <img src="/logo-mathswell-square-mirror.svg" alt="Mathswell" width="28" height="28" style="display:block">
    <span>MATHSWELL</span>
  </a>
</div>
        
        <div class="tabs">
            <button class="tab active" data-tab="learn">Learn</button>
            <button class="tab locked" data-tab="practice">Practice <span class="lock-icon">ðŸ”’</span></button>
            <button class="tab locked" data-tab="analysis">Analysis <span class="lock-icon">ðŸ”’</span></button>
        </div>

        <!-- Learn Tab -->
        <div id="learn" class="tab-content active">
            <h2>Learn the Fundamentals</h2>
            
            <div class="tutorial-step" id="step1">
                <div class="step-header">
                    <h3><span class="step-number">1</span> Understanding "If P, then Q" Visually</h3>
                </div>
                <p>A conditional statement has two parts:</p>
                <ul style="margin: 1rem 0; padding-left: 2rem;">
                    <li><strong>Hypothesis (P):</strong> The "if" part - the condition</li>
                    <li><strong>Conclusion (Q):</strong> The "then" part - what follows</li>
                </ul>
                
                <p style="margin-top: 1.5rem;">Explore different arrangements of P and Q circles:</p>
                
                <div class="venn-container">
                    <div id="demo-venn-box" class="venn-box"></div>
                </div>
                
                <div class="exploration-controls">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Select a scenario:</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn-secondary" onclick="setScenario('p-in-q', this)" style="padding: 0.75rem;">P inside Q</button>
                        <button class="btn-secondary" onclick="setScenario('q-in-p', this)" style="padding: 0.75rem;">Q inside P</button>
                        <button class="btn-secondary" onclick="setScenario('overlap', this)" style="padding: 0.75rem;">P and Q overlap</button>
                        <button class="btn-secondary" onclick="setScenario('disjoint', this)" style="padding: 0.75rem;">P and Q separate</button>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; background: var(--primary-light); border-radius: 12px;">
                    <p style="font-weight: 600;">ðŸ“Œ Important: The statement "If P, then Q" is true ONLY when P is entirely inside Q (the first scenario).</p>
                    <p style="margin-top: 0.5rem;">In all other arrangements, we can find counterexamples where P is true but Q is false.</p>
                </div>
                
                <button class="btn-primary" onclick="completeStep(1)">I see how it works!</button>
            </div>
            
            <div class="tutorial-step hidden" id="step2">
                <div class="step-header">
                    <h3><span class="step-number">2</span> Real Examples with Visuals</h3>
                </div>
                <p>Let's apply this to concrete examples:</p>
                
                <div class="example-container">
                    <div class="example-card">
                        <h4>Example 1: Numbers</h4>
                        <p><strong>Statement:</strong> If a number is divisible by 6, then it is divisible by 3.</p>
                        <p><strong>Analysis:</strong> TRUE âœ“</p>
                        <p>Any multiple of 6 (like 6, 12, 18) is also a multiple of 3.</p>
                        <div style="text-align: center; margin-top: 1rem;">
                            <svg viewBox="-1 -1 2 2" width="150" height="150">
                                <circle cx="0" cy="0" r="0.7" fill="rgba(124, 58, 237, 0.1)" stroke="#7c3aed" stroke-width="0.03"></circle>
                                <text x="0" y="-0.8" fill="#7c3aed" font-size="0.12" text-anchor="middle">Divisible by 3</text>
                                <circle cx="0" cy="0" r="0.4" fill="rgba(15, 118, 110, 0.2)" stroke="#0f766e" stroke-width="0.03"></circle>
                                <text x="0" y="0" fill="#0f766e" font-size="0.12" text-anchor="middle">Div. by 6</text>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="example-card">
                        <h4>Example 2: Geometry</h4>
                        <p><strong>Statement:</strong> If a shape is a square, then it has four sides.</p>
                        <p><strong>Analysis:</strong> TRUE âœ“</p>
                        <p>Every square must have exactly four sides.</p>
                        <div style="text-align: center; margin-top: 1rem;">
                            <svg viewBox="-1 -1 2 2" width="150" height="150">
                                <circle cx="0" cy="0" r="0.7" fill="rgba(124, 58, 237, 0.1)" stroke="#7c3aed" stroke-width="0.03"></circle>
                                <text x="0" y="-0.8" fill="#7c3aed" font-size="0.12" text-anchor="middle">4-sided shapes</text>
                                <circle cx="0" cy="0" r="0.35" fill="rgba(15, 118, 110, 0.2)" stroke="#0f766e" stroke-width="0.03"></circle>
                                <text x="0" y="0" fill="#0f766e" font-size="0.12" text-anchor="middle">Squares</text>
                            </svg>
                        </div>
                        <p style="margin-top: 1rem;"><strong>Note:</strong> The reverse isn't true - rectangles have 4 sides but aren't squares!</p>
                    </div>
                </div>
                
                <button class="btn-primary" onclick="completeStep(2)">Show me practice problems!</button>
            </div>
            
            <div class="tutorial-step hidden" id="step3">
                <div class="step-header">
                    <h3><span class="step-number">3</span> Check Your Understanding</h3>
                </div>
                <p>Before we start practice problems, let's verify your understanding:</p>
                
                <div style="background: var(--light-gray); padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0;">
                    <h4>Quick Check:</h4>
                    <p style="margin: 1rem 0;"><strong>Statement:</strong> <span id="checkStatement">"If x is even, then x is divisible by 2"</span></p>
                    <p>Is this statement true or false?</p>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button class="btn-secondary" onclick="checkAnswer(true)">TRUE</button>
                        <button class="btn-secondary" onclick="checkAnswer(false)">FALSE</button>
                    </div>
                    <div id="quickCheckFeedback" style="margin-top: 1rem; display: none;"></div>
                </div>
                
                <div id="readySection" style="display: none;">
                    <button class="btn-primary" onclick="completeStep(3)">Start Practice Mode!</button>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--dark-gray);">
                        ðŸ’¡ Tip: Once you complete this learning section, the Practice and Analysis tabs will remain unlocked for your next visit.
                    </p>
                </div>
            </div>
        </div>

        <!-- Practice Tab -->
        <div id="practice" class="tab-content">
            <h2>Practice Problems</h2>
            
            <div class="stats-dashboard">
                <div class="stat-card">
                    <div class="stat-value" id="statCorrect">0</div>
                    <div class="stat-label">Correct</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statAttempts">0</div>
                    <div class="stat-label">Attempts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statStreak">0</div>
                    <div class="stat-label">Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statLevel">Foundation</div>
                    <div class="stat-label">Level</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 2rem 0;">
                <div>
                    <label style="font-weight: 600;">Category:</label>
                    <select id="categorySelect" style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; border: 2px solid var(--medium-gray); border-radius: 8px;">
                        <option value="Numbers">Numbers</option>
                        <option value="Geometry">Geometry</option>
                        <option value="Number Theory">Number Theory</option>
                        <option value="Calculus">Calculus</option>
                    </select>
                </div>
                <div>
                    <label style="font-weight: 600;">AI Difficulty:</label>
                    <select id="difficultySelect" style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; border: 2px solid var(--medium-gray); border-radius: 8px;">
                        <option value="Foundation">Foundation</option>
                        <option value="Medium" disabled>Medium (Locked)</option>
                        <option value="Advanced" disabled>Advanced (Locked)</option>
                    </select>
                </div>
            </div>
            
            <button class="btn-primary" id="generateBtn" onclick="generateProblem()" style="width: 100%;">ðŸ¤– Generate Problem with AI</button>
            
            <div id="problemDisplay" style="margin: 2rem 0; padding: 1.5rem; background: var(--primary-light); border-radius: 12px; display: none;">
                <h3>Problem Statement</h3>
                <p id="problemText"></p>
            </div>
            
            <div class="venn-container" id="practiceVennContainer" style="display: none;">
                <div id="practice-venn-box" class="venn-box"></div>
            </div>
            
            <div class="hint-container" id="hintContainer" style="display: none;">
                <button class="hint-btn" id="hintBtn" onclick="showHint()">Need a Hint? (3 available)</button>
                <div class="hint-text" id="hintText"></div>
            </div>
            
            <div id="practiceQuizSection" style="display: none;">
                <h3>Analyze the Converse</h3>
                <p id="converseStatement" style="font-size: 1.1rem; margin: 1rem 0;"></p>
                
                <div style="text-align: center; margin: 2rem 0;">
                    <p style="font-weight: 600; margin-bottom: 1rem;">Is the converse true or false?</p>
                    <button class="btn-secondary" onclick="submitAnswer(true)" style="margin: 0 0.5rem;">TRUE</button>
                    <button class="btn-secondary" onclick="submitAnswer(false)" style="margin: 0 0.5rem;">FALSE</button>
                </div>
            </div>
            
            <div id="counterexampleSection" class="hidden">
                <h3>Provide a Counterexample</h3>
                <p>You correctly identified it as false! Now provide a specific value where Q is true but P is false:</p>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <input type="text" id="counterexampleInput" placeholder="Enter your counterexample" style="flex: 1; padding: 0.75rem; border: 2px solid var(--medium-gray); border-radius: 8px;">
                    <button class="btn-primary" onclick="checkCounterexample()">Check</button>
                </div>
            </div>
            
            <div class="feedback-detailed hidden" id="feedbackSection">
                <h3 id="feedbackTitle"></h3>
                <div id="feedbackContent"></div>
                <button class="btn-primary" onclick="nextProblem()" style="margin-top: 1rem;">Next Problem</button>
            </div>
            
            <!-- Challenge AI Form -->
            <form id="challengeForm" class="form-section hidden" style="background: var(--light-gray); padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem;">
                <h3>Challenge the AI's Assessment</h3>
                <p>If you believe the AI is incorrect, please explain your reasoning.</p>
                <div class="control-group" style="width:100%; margin-top: 1rem;">
                    <textarea id="challengeInput" rows="3" placeholder="My reasoning is..." required style="width: 100%; padding: 0.75rem; border: 2px solid var(--medium-gray); border-radius: 8px;"></textarea>
                </div>
                <button type="submit" class="btn-primary" style="margin-top: 1rem;">Submit Challenge</button>
            </form>
        </div>

        <!-- Analysis Tab -->
        <div id="analysis" class="tab-content">
            <h2>Complete Analysis</h2>
            
            <div id="analysisEmpty" style="text-align: center; padding: 3rem;">
                <p style="color: var(--dark-gray);">Complete a practice problem first to see the analysis!</p>
            </div>
            
            <div id="analysisContent" class="hidden">
                <div id="analysisStatementDisplay" style="padding: 1.5rem; background: var(--primary-light); border-radius: 12px; margin-bottom: 2rem;"></div>
                
                <div class="analysis-reveal-container">
                    <h3>Explore Related Statements</h3>
                    <p>Click to reveal each related form one at a time:</p>
                    <button class="reveal-btn" id="revealConverse" onclick="revealStatement('converse')">Reveal Converse</button>
                    <button class="reveal-btn" id="revealInverse" onclick="revealStatement('inverse')" disabled>Reveal Inverse</button>
                    <button class="reveal-btn" id="revealContrapositive" onclick="revealStatement('contrapositive')" disabled>Reveal Contrapositive</button>
                    <button class="reveal-btn" id="revealConditions" onclick="revealStatement('conditions')" disabled>Reveal Conditions</button>
                </div>
                
                <div id="analysisCards" style="display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-top: 2rem;"></div>
                
                <div class="comparison-mode hidden" id="comparisonMode">
                    <h3 style="grid-column: 1 / -1;">Side-by-Side Comparison</h3>
                    <div class="comparison-card" id="compareCard1"></div>
                    <div class="comparison-card" id="compareCard2"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    // Enhanced State Management
    let state = {
        currentTab: 'learn',
        progress: {
            steps: 0,
            totalSteps: 3,
            unlockedTabs: ['learn'],
            currentLevel: 'Foundation'
        },
        stats: {
            correct: 0,
            attempts: 0,
            streak: 0,
            hintsUsed: 0,
            hintsRemaining: 3
        },
        currentProblem: null,
        lastAIResponse: '', // Store AI reasoning for challenges
        revealedStatements: [],
        testCases: [],
        checkAttempt: 0
    };

    // Alternative check statements for when user gets it wrong
    const checkStatements = [
        { statement: "If x is even, then x is divisible by 2", answer: true },
        { statement: "If a number is prime, then it is odd", answer: false }, // 2 is prime but even
        { statement: "If x > 5, then x > 3", answer: true },
        { statement: "If a shape is a rectangle, then it is a square", answer: false }
    ];

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        // Check if user has completed the learning section before
        if (localStorage.getItem('logicExplorerCompleted') === 'true') {
            unlockTab('practice');
            unlockTab('analysis');
        }
        
        initializeDemoVenn();
        setupEventListeners();
    });

    function completeStep(stepNum) {
        document.getElementById(`step${stepNum}`).classList.add('completed');
        state.progress.steps = stepNum;
        
        if (stepNum < 3) {
            document.getElementById(`step${stepNum + 1}`).classList.remove('hidden');
        }
        
        if (stepNum === 3) {
            unlockTab('practice');
            // Save completion status to localStorage
            localStorage.setItem('logicExplorerCompleted', 'true');
            showNotification('Practice mode unlocked!', 'success');
        }
    }

    function unlockTab(tabName) {
        if (!state.progress.unlockedTabs.includes(tabName)) {
            state.progress.unlockedTabs.push(tabName);
        }
        
        const tabBtn = document.querySelector(`.tab[data-tab="${tabName}"]`);
        if (tabBtn) {
            tabBtn.classList.remove('locked');
            tabBtn.querySelector('.lock-icon')?.remove();
        }
        
        if (tabName === 'practice') {
            setTimeout(() => unlockTab('analysis'), 100);
        }
    }

    // Tab Switching
    function setupEventListeners() {
        document.querySelector('.tabs').addEventListener('click', e => {
            if (e.target.matches('.tab') && !e.target.classList.contains('locked')) {
                switchTab(e.target.dataset.tab);
            } else if (e.target.matches('.tab.locked')) {
                showNotification('Complete the learning steps to unlock this section!', 'warning');
            }
        });
        
        // Challenge form submission
        const challengeForm = document.getElementById('challengeForm');
        if (challengeForm) {
            challengeForm.addEventListener('submit', handleChallengeSubmit);
        }
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        state.currentTab = tabName;
    }

    // Demo Venn Diagram with Scenarios
    function initializeDemoVenn() {
        const vennBox = document.getElementById('demo-venn-box');
        if (!vennBox) return;
        
        setScenario('p-in-q'); // Start with the true case
    }

    function setScenario(scenario, buttonElement) {
        const vennBox = document.getElementById('demo-venn-box');
        if (!vennBox) return;
        
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, 'svg');
        svg.setAttribute('viewBox', '-1 -1 2 2');
        
        switch(scenario) {
            case 'p-in-q':
                // P entirely inside Q
                createCircle(svg, 0, 0, 0.7, 'rgba(124, 58, 237, 0.1)', '#7c3aed', 'Q');
                createCircle(svg, 0, 0, 0.35, 'rgba(15, 118, 110, 0.2)', '#0f766e', 'P');
                break;
                
            case 'q-in-p':
                // Q inside P
                createCircle(svg, 0, 0, 0.7, 'rgba(15, 118, 110, 0.1)', '#0f766e', 'P');
                createCircle(svg, 0, 0, 0.35, 'rgba(124, 58, 237, 0.2)', '#7c3aed', 'Q');
                break;
                
            case 'overlap':
                // P and Q overlap but neither contains the other
                createCircle(svg, -0.25, 0, 0.45, 'rgba(15, 118, 110, 0.2)', '#0f766e', 'P');
                createCircle(svg, 0.25, 0, 0.45, 'rgba(124, 58, 237, 0.1)', '#7c3aed', 'Q');
                break;
                
            case 'disjoint':
                // P and Q are completely separate
                createCircle(svg, -0.4, 0, 0.3, 'rgba(15, 118, 110, 0.2)', '#0f766e', 'P');
                createCircle(svg, 0.4, 0, 0.3, 'rgba(124, 58, 237, 0.1)', '#7c3aed', 'Q');
                break;
        }
        
        vennBox.innerHTML = '';
        vennBox.appendChild(svg);
        
        // Highlight the selected button
        document.querySelectorAll('.exploration-controls .btn-secondary').forEach(btn => {
            btn.style.background = 'white';
            btn.style.color = 'var(--primary-color)';
        });
        
        // Highlight the button that was clicked (if provided)
        if (buttonElement) {
            buttonElement.style.background = 'var(--primary-light)';
        }
    }

    function createCircle(svg, cx, cy, r, fill, stroke, label) {
        const svgNS = "http://www.w3.org/2000/svg";
        
        const circle = document.createElementNS(svgNS, "circle");
        circle.setAttribute("cx", cx.toString());
        circle.setAttribute("cy", cy.toString());
        circle.setAttribute("r", r.toString());
        circle.setAttribute("fill", fill);
        circle.setAttribute("stroke", stroke);
        circle.setAttribute("stroke-width", "0.03");
        svg.appendChild(circle);
        
        const text = document.createElementNS(svgNS, "text");
        text.setAttribute("x", cx.toString());
        text.setAttribute("y", (cy - r - 0.1).toString());
        text.setAttribute("fill", stroke);
        text.setAttribute("font-size", "0.2");
        text.setAttribute("font-weight", "bold");
        text.setAttribute("text-anchor", "middle");
        text.textContent = label;
        svg.appendChild(text);
    }

    function checkAnswer(userAnswer) {
        const feedbackDiv = document.getElementById('quickCheckFeedback');
        const statementSpan = document.getElementById('checkStatement');
        feedbackDiv.style.display = 'block';
        
        const currentCheck = checkStatements[state.checkAttempt % checkStatements.length];
        
        if (userAnswer === currentCheck.answer) {
            feedbackDiv.innerHTML = '<p style="color: var(--success-color);">âœ“ Correct!</p>';
            document.getElementById('readySection').style.display = 'block';
        } else {
            feedbackDiv.innerHTML = '<p style="color: var(--error-color);">Not quite. Try this one:</p>';
            state.checkAttempt++;
            const nextCheck = checkStatements[state.checkAttempt % checkStatements.length];
            statementSpan.textContent = `"${nextCheck.statement}"`;
        }
    }

    // Explore Mode Functions - Removed since tab was removed

    // Practice Mode Functions
    async function generateProblem() {
        const btn = document.getElementById('generateBtn');
        btn.disabled = true;
        btn.textContent = 'ðŸ§  Generating...';
        
        const category = document.getElementById('categorySelect').value;
        const difficulty = state.progress.currentLevel;
        
        const prompt = `
            You are a mathematics educator creating a logic problem.
            Generate an 'If P, then Q' conditional statement about "${category}" with a difficulty of "${difficulty}".
            RULES:
            1. 'If P, then Q' must be logically true.
            2. You must also generate the converse, inverse, and contrapositive statements.
            3. For each of these three new statements, determine its truth value (true/false).
            4. If a statement is false, provide a specific, concise counterexample.
            5. Also provide the simple negations for P and Q.
            6. Use LaTeX for all mathematical notation, like $...$ for inline math.
            7. Return ONLY a single, valid JSON object.
            
            Example JSON structure:
            {
              "p": "a number is a multiple of $6$",
              "q": "it is a multiple of $3$",
              "not_p": "a number is not a multiple of $6$",
              "not_q": "it is not a multiple of $3$",
              "converse": { "statement": "If it is a multiple of $3$, then it is a multiple of $6$", "truth": false, "counterexample": "$9$" },
              "inverse": { "statement": "If a number is not a multiple of $6$, then it is not a multiple of $3$", "truth": false, "counterexample": "$3$" },
              "contrapositive": { "statement": "If it is not a multiple of $3$, then it is not a multiple of $6$", "truth": true, "counterexample": null }
            }
        `;
        
        try {
            const response = await callAI(prompt);
            state.currentProblem = JSON.parse(response);
            displayProblem();
            
            // Reset hint system
            state.stats.hintsRemaining = 3;
            document.getElementById('hintBtn').disabled = false;
            document.getElementById('hintBtn').textContent = `Need a Hint? (${state.stats.hintsRemaining} available)`;
            
        } catch (error) {
            console.error('Failed to generate problem:', error);
            showNotification('Failed to generate problem. Please try again.', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'ðŸ¤– Generate Problem with AI';
        }
    }

    async function callAI(prompt) {
        const apiUrl = '/api/gemini';
        const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error(`API request failed: ${response.status}`);
        const result = await response.json();

        if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
            const text = result.candidates[0].content.parts[0].text;
            return text.replace(/```json/g, '').replace(/```/g, '').trim();
        }
        
        throw new Error("Could not get a valid response from the AI.");
    }

    function displayProblem() {
        const { p, q, converse } = state.currentProblem;
        
        document.getElementById('problemDisplay').style.display = 'block';
        document.getElementById('problemText').innerHTML = `<strong>If P, then Q:</strong> If ${p}, then ${q}.`;
        
        document.getElementById('practiceVennContainer').style.display = 'block';
        buildPracticeVenn();
        
        document.getElementById('converseStatement').innerHTML = `<strong>Converse:</strong> ${converse.statement}`;
        document.getElementById('practiceQuizSection').style.display = 'block';
        document.getElementById('hintContainer').style.display = 'block';
        
        // Hide previous sections
        document.getElementById('counterexampleSection').classList.add('hidden');
        document.getElementById('feedbackSection').classList.add('hidden');
        
        typesetMath([
            document.getElementById('problemText'),
            document.getElementById('converseStatement')
        ]);
    }

    function buildPracticeVenn() {
        const vennBox = document.getElementById('practice-venn-box');
        if (!vennBox || !state.currentProblem) return;
        
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, 'svg');
        svg.setAttribute('viewBox', '-1 -1 2 2');
        
        const { converse } = state.currentProblem;
        const isConverseTrue = converse.truth;
        
        // Q circle
        const qCircle = document.createElementNS(svgNS, "circle");
        qCircle.setAttribute("cx", "0");
        qCircle.setAttribute("cy", "0");
        qCircle.setAttribute("r", "0.62");
        qCircle.setAttribute("fill", "rgba(124, 58, 237, 0.1)");
        qCircle.setAttribute("stroke", "#7c3aed");
        qCircle.setAttribute("stroke-width", "0.03");
        svg.appendChild(qCircle);
        
        // P circle
        const pRadius = isConverseTrue ? "0.62" : "0.4";
        const pCircle = document.createElementNS(svgNS, "circle");
        pCircle.setAttribute("cx", "0");
        pCircle.setAttribute("cy", "0");
        pCircle.setAttribute("r", pRadius);
        pCircle.setAttribute("fill", "rgba(15, 118, 110, 0.2)");
        pCircle.setAttribute("stroke", "#0f766e");
        pCircle.setAttribute("stroke-width", "0.03");
        svg.appendChild(pCircle);
        
        // Labels
        const qLabel = document.createElementNS(svgNS, "text");
        qLabel.setAttribute("x", "0");
        qLabel.setAttribute("y", "-0.7");
        qLabel.setAttribute("fill", "#7c3aed");
        qLabel.setAttribute("font-size", "0.25");
        qLabel.setAttribute("font-weight", "bold");
        qLabel.setAttribute("text-anchor", "middle");
        qLabel.textContent = "Q";
        svg.appendChild(qLabel);
        
        const pLabel = document.createElementNS(svgNS, "text");
        pLabel.setAttribute("x", "0");
        pLabel.setAttribute("y", "0.08");
        pLabel.setAttribute("fill", "#0f766e");
        pLabel.setAttribute("font-size", "0.3");
        pLabel.setAttribute("font-weight", "bold");
        pLabel.setAttribute("text-anchor", "middle");
        pLabel.textContent = "P";
        svg.appendChild(pLabel);
        
        vennBox.innerHTML = '';
        vennBox.appendChild(svg);
    }

    function showHint() {
        if (state.stats.hintsRemaining <= 0) return;
        
        state.stats.hintsRemaining--;
        state.stats.hintsUsed++;
        
        const hintBtn = document.getElementById('hintBtn');
        const hintText = document.getElementById('hintText');
        
        hintBtn.textContent = `Need a Hint? (${state.stats.hintsRemaining} available)`;
        
        if (state.stats.hintsRemaining === 0) {
            hintBtn.disabled = true;
        }
        
        // Progressive hints
        let hint = '';
        if (state.stats.hintsUsed === 1) {
            hint = 'Look at the Venn diagram. Can you find a region where Q is true but P is false?';
            document.getElementById('practice-venn-box').classList.add('hint-highlight');
            setTimeout(() => {
                document.getElementById('practice-venn-box').classList.remove('hint-highlight');
            }, 3000);
        } else if (state.stats.hintsUsed === 2) {
            hint = 'Remember: The converse swaps P and Q. If the original is "If P, then Q", the converse is "If Q, then P".';
        } else if (state.stats.hintsUsed === 3) {
            hint = `Think about whether every ${state.currentProblem.q} must also be ${state.currentProblem.p}.`;
        }
        
        hintText.textContent = hint;
        hintText.classList.add('visible');
    }

    function submitAnswer(userAnswer) {
        state.stats.attempts++;
        const isCorrect = userAnswer === state.currentProblem.converse.truth;
        
        if (isCorrect) {
            state.stats.correct++;
            state.stats.streak++;
            
            if (userAnswer === false) {
                // They correctly identified it as false, ask for counterexample
                document.getElementById('practiceQuizSection').style.display = 'none';
                document.getElementById('counterexampleSection').classList.remove('hidden');
            } else {
                // They correctly identified it as true
                showDetailedFeedback(true, null);
            }
            
            // Check for level unlock
            if (state.stats.streak >= 3 && state.progress.currentLevel === 'Foundation') {
                unlockDifficulty('Medium');
            } else if (state.stats.streak >= 5 && state.progress.currentLevel === 'Medium') {
                unlockDifficulty('Advanced');
            }
        } else {
            state.stats.streak = 0;
            showDetailedFeedback(false, null);
        }
        
        updateStats();
    }

    async function checkCounterexample() {
        const userCounterexample = document.getElementById('counterexampleInput').value;
        if (!userCounterexample) return;
        
        const { p, q } = state.currentProblem;
        const prompt = `
            A user is analyzing the statement: "If ${q}, then ${p}."
            They claim "${userCounterexample}" is a counterexample.
            A valid counterexample must make "${q}" true and "${p}" false.
            
            Respond briefly. Use LaTeX for math notation.
            If valid, start with "Yes, that works because..."
            If invalid, start with "Not quite..." and explain.
        `;
        
        try {
            const response = await callAI(prompt);
            state.lastAIResponse = response; // Store for potential challenge
            const isValid = response.toLowerCase().startsWith('yes');
            showDetailedFeedback(isValid, response);
        } catch (error) {
            showNotification('Failed to check counterexample. Please try again.', 'error');
        }
    }

    async function handleChallengeSubmit(e) {
        e.preventDefault();
        const userReasoning = document.getElementById('challengeInput').value;
        document.getElementById('challengeForm').classList.add('hidden');
        showDetailedFeedback('loading', '<h3>Re-evaluating with AI...</h3>');

        const prompt = `
            You are a humble math tutor AI. You previously made an assessment, and a user is challenging it.
            Original Problem: If P, then Q is "If ${state.currentProblem.p}, then ${state.currentProblem.q}".
            The statement being analyzed was the converse: "If ${state.currentProblem.q}, then ${state.currentProblem.p}".
            Your previous analysis/response was: "${state.lastAIResponse}"
            The user is challenging you with this reasoning: "${userReasoning}"

            Task: Re-evaluate everything. Use LaTeX for any math notation.
            - If the user is correct, you MUST admit your mistake and provide the corrected explanation.
            - If the user is wrong, politely explain the flaw in their reasoning.
        `;
        
        try {
            const aiReevaluation = await callAI(prompt);
            showDetailedFeedback('neutral', `<h3>AI Re-evaluation:</h3><p>${aiReevaluation}</p>`);
        } catch (error) {
            console.error("AI re-evaluation failed:", error);
            showDetailedFeedback('error', `<h3>Error</h3><p>Could not process the challenge. Please try again.</p>`);
        }
    }

    function showDetailedFeedback(isCorrect, aiResponse) {
        const feedbackSection = document.getElementById('feedbackSection');
        const feedbackTitle = document.getElementById('feedbackTitle');
        const feedbackContent = document.getElementById('feedbackContent');
        
        document.getElementById('practiceQuizSection').style.display = 'none';
        document.getElementById('counterexampleSection').classList.add('hidden');
        document.getElementById('challengeForm').classList.add('hidden');
        feedbackSection.classList.remove('hidden');
        
        if (isCorrect === 'loading') {
            feedbackTitle.textContent = '';
            feedbackContent.innerHTML = aiResponse;
        } else if (isCorrect === 'neutral') {
            feedbackTitle.textContent = '';
            feedbackContent.innerHTML = aiResponse;
        } else if (isCorrect === true) {
            feedbackTitle.textContent = 'âœ“ Correct!';
            feedbackTitle.style.color = 'var(--success-color)';
            
            let content = '<div class="feedback-step">';
            content += '<div class="feedback-step-number">1</div>';
            content += '<div class="feedback-step-content">You correctly identified the converse\'s truth value!</div>';
            content += '</div>';
            
            if (aiResponse) {
                content += '<div class="feedback-step">';
                content += '<div class="feedback-step-number">2</div>';
                content += `<div class="feedback-step-content">AI Feedback: ${aiResponse}</div>`;
                content += '</div>';
                
                // Add challenge button for counterexample feedback
                content += '<button class="challenge-btn" onclick="showChallengeForm()">ðŸ¤” Challenge AI\'s Assessment</button>';
            }
            
            feedbackContent.innerHTML = content;
        } else {
            feedbackTitle.textContent = 'âœ— Not Quite';
            feedbackTitle.style.color = 'var(--error-color)';
            
            let content = '<div class="feedback-step">';
            content += '<div class="feedback-step-number">1</div>';
            
            if (typeof isCorrect === 'boolean') {
                // This is from submitAnswer (true/false question)
                const truthText = state.currentProblem.converse.truth ? 'TRUE' : 'FALSE';
                content += `<div class="feedback-step-content">The converse is actually <strong>${truthText}</strong>.</div>`;
                content += '</div>';
                
                if (!state.currentProblem.converse.truth) {
                    content += '<div class="feedback-step">';
                    content += '<div class="feedback-step-number">2</div>';
                    content += `<div class="feedback-step-content">A counterexample is: <strong>${state.currentProblem.converse.counterexample}</strong></div>`;
                    content += '</div>';
                }
                
                content += '<div class="feedback-step">';
                content += '<div class="feedback-step-number">3</div>';
                content += '<div class="feedback-step-content">Remember: The converse swaps P and Q. Look at the Venn diagram to see why this changes the truth value.</div>';
                content += '</div>';
            } else {
                // This is from checkCounterexample (AI feedback)
                content += `<div class="feedback-step-content">AI Feedback: ${aiResponse}</div>`;
                content += '</div>';
                
                // Add challenge button for counterexample feedback
                content += '<button class="challenge-btn" onclick="showChallengeForm()">ðŸ¤” Challenge AI\'s Assessment</button>';
            }
            
            feedbackContent.innerHTML = content;
        }
        
        typesetMath([feedbackContent]);
        
        // Enable analysis tab with current problem
        displayAnalysis();
    }

    function showChallengeForm() {
        document.getElementById('challengeForm').classList.remove('hidden');
        document.getElementById('feedbackSection').classList.add('hidden');
    }

    function nextProblem() {
        document.getElementById('feedbackSection').classList.add('hidden');
        document.getElementById('challengeForm').classList.add('hidden');
        generateProblem();
    }

    function updateStats() {
        document.getElementById('statCorrect').textContent = state.stats.correct;
        document.getElementById('statAttempts').textContent = state.stats.attempts;
        document.getElementById('statStreak').textContent = state.stats.streak;
        document.getElementById('statLevel').textContent = state.progress.currentLevel;
    }

    function unlockDifficulty(level) {
        state.progress.currentLevel = level;
        const select = document.getElementById('difficultySelect');
        const option = select.querySelector(`option[value="${level}"]`);
        if (option) {
            option.disabled = false;
            option.textContent = level;
        }
        showNotification(`${level} difficulty unlocked!`, 'success');
    }

    // Analysis Tab Functions
    function displayAnalysis() {
        if (!state.currentProblem) return;
        
        document.getElementById('analysisEmpty').classList.add('hidden');
        document.getElementById('analysisContent').classList.remove('hidden');
        
        const { p, q } = state.currentProblem;
        document.getElementById('analysisStatementDisplay').innerHTML = `
            <strong>Original Statement:</strong> If ${p}, then ${q}.
        `;
        
        // Reset reveal buttons
        state.revealedStatements = [];
        document.getElementById('analysisCards').innerHTML = '';
        document.getElementById('revealConverse').disabled = false;
        document.getElementById('revealInverse').disabled = true;
        document.getElementById('revealContrapositive').disabled = true;
        document.getElementById('revealConditions').disabled = true;
        
        typesetMath([document.getElementById('analysisStatementDisplay')]);
    }

    function revealStatement(type) {
        if (!state.currentProblem || state.revealedStatements.includes(type)) return;
        
        state.revealedStatements.push(type);
        const cardsContainer = document.getElementById('analysisCards');
        
        const card = document.createElement('div');
        card.style = 'padding: 1.5rem; background: white; border-radius: 12px; box-shadow: var(--shadow-md); animation: slideIn 0.5s ease;';
        
        switch(type) {
            case 'converse': {
                const converseData = state.currentProblem.converse;
                card.innerHTML = `
                    <h4>Converse <span class="truth-badge ${converseData.truth}">${converseData.truth ? 'TRUE' : 'FALSE'}</span></h4>
                    <p style="font-style: italic; color: var(--dark-gray);">If Q, then P</p>
                    <p>${converseData.statement}</p>
                    ${!converseData.truth ? `<p><strong>Counterexample:</strong> ${converseData.counterexample}</p>` : ''}
                `;
                document.getElementById('revealInverse').disabled = false;
                break;
            }
                
            case 'inverse': {
                const inverseData = state.currentProblem.inverse;
                card.innerHTML = `
                    <h4>Inverse <span class="truth-badge ${inverseData.truth}">${inverseData.truth ? 'TRUE' : 'FALSE'}</span></h4>
                    <p style="font-style: italic; color: var(--dark-gray);">If not P, then not Q</p>
                    <p>${inverseData.statement}</p>
                    ${!inverseData.truth ? `<p><strong>Counterexample:</strong> ${inverseData.counterexample}</p>` : ''}
                `;
                document.getElementById('revealContrapositive').disabled = false;
                break;
            }
                
            case 'contrapositive': {
                const contrapositiveData = state.currentProblem.contrapositive;
                card.innerHTML = `
                    <h4>Contrapositive <span class="truth-badge ${contrapositiveData.truth}">${contrapositiveData.truth ? 'TRUE' : 'FALSE'}</span></h4>
                    <p style="font-style: italic; color: var(--dark-gray);">If not Q, then not P</p>
                    <p>${contrapositiveData.statement}</p>
                    <p style="font-style: italic;">This is always logically equivalent to the original statement.</p>
                `;
                document.getElementById('revealConditions').disabled = false;
                break;
            }
                
            case 'conditions': {
                const pStatement = state.currentProblem.p;
                const qStatement = state.currentProblem.q;
                const converseIsTrue = state.currentProblem.converse.truth;
                
                let conditionsHTML = `
                    <h4>Necessary & Sufficient Conditions</h4>
                    <p><strong>Sufficient:</strong> Knowing that "${pStatement}" is true is sufficient to conclude that "${qStatement}" is true.</p>
                    <p><strong>Necessary:</strong> For "${pStatement}" to be true, it is necessary that "${qStatement}" is also true.</p>
                `;
                
                if (converseIsTrue) {
                    conditionsHTML += `
                        <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--medium-gray);">
                        <p><strong>Biconditional:</strong> P is necessary and sufficient for Q (and vice-versa).</p>
                    `;
                }
                card.innerHTML = conditionsHTML;
                break;
            }
        }
        
        cardsContainer.appendChild(card);
        typesetMath([card]);
        
        // Enable comparison mode after 2 reveals
        if (state.revealedStatements.length >= 2) {
            setupComparisonMode();
        }
    }

    function setupComparisonMode() {
        // Optional: Add comparison functionality
    }

    function typesetMath(elements) {
        if (window.MathJax && window.MathJax.startup?.promise) {
            window.MathJax.startup.promise.then(() => {
                window.MathJax.typesetPromise(elements).catch((err) => console.log('MathJax Error: ' + err.message));
            });
        }
    }

    function showNotification(message, type) {
        // Simple notification (could be enhanced with a toast library)
        console.log(`[${type.toUpperCase()}] ${message}`);
    }

</script>
   
</body>
</html>






















